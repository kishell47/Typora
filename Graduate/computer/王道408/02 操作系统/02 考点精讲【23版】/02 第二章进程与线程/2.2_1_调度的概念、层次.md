# 调度的概念、层次



## 知识总览

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160915357.png" alt="image-20230516091523208" style="zoom:50%;" />

* 在这个小节中会学习处理机调度的基本概念和几个调度的层次。 分别为高级调度，中级调度和低级调度，其中由中级调度也就是内存调度会引出补充一个课本上没有太多提及的知识点。 就是进程的挂起态，并且会介绍进程状态的七状态模型，之后还会介绍三个调度层次的联系和对比

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160919048.png" alt="image-20230516091900924" style="zoom: 67%;" />

* 首先看一下什么是调度，其实调度这个概念和我们的生活离得并不遥远，比如说在去银行的时候，这个银行可能只有几个窗口，可以为客户服务。这些客户到底应该先为谁服务，银行一般采用的是先到先服务的这种原则。

* 如果说此时有一个VIP客户，这个客户在银行里存了几个小目标，就是存了几个亿，那么这个VIP客户可能就会被银行优先服务，他的优先级更高。 再看另外一个场景，早上起床的时候，可能每个宿舍只有一个卫生间，但是大家都想成为坐在王座上的男人。 那么每个人都想使用，但是有的人说我想要使用三分钟，有的人要十分钟，有的人要一分钟，还有一个人他也需要使用三分钟，大家经过商量之后就决定了使用资源的原则就是时间使用短的,让他先使用,而时间长的就后使用，如果说时间长度相同的，那么就先进入这个队列，先排队的就可以先使用，所以大家经过商量之后就决定用1234这样的顺序来使用卫生间这个资
  源，所以其实所谓的调度，它就是指当我们有一堆东西，一堆任务要处理的时候，由于当前的资源有限，那么这些事情没办法同时的被处理，这个时候就需要按照某种规则，比如说先到先服务，或者说。 时间短的优先，各种规则来决定要用什么样的顺序来处理这些任务。 这就是调度研究的问题。

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160924287.png" alt="image-20230516092429174" style="zoom:67%;" />

* 看一下在程序运行的整个生命周期内，什么时候会发生调度的情况？

* 第一种调度叫做高级调度，又叫做作业调
  度，所以这儿需要补充作业的概念，作业的概念其实在之前的讲解中或多或少是提过的。所谓的作业，其实指的就是某一个具体的任务，大家在书里面会看到这样的描述，就是说用户向操作系统提交了一个作业。那这句话其实你可以理解为用户让操作系统帮他启动某一个特定的程序。然后这个程序是来处理某一个具体的任务的，所以这就是作业的概念。

* 要启动一个程序，这个程序相关的数据肯定需要从外存放到内存里边。 但是内存资源又是有限的，所以有时候如果内存已经满了，内存资源不足的话，那么我们给操作系统提交的这些作业或者说想让系统帮我们启动的这些程序有可能没办法马上把它们放到内存，马上启动。 所以在这个时候，操作系
  统就会进行所谓的高级调度，或者也可以称之为作业调度，操作系统会按照作业调度相关的规则从作业后备队列里边选择一个作业，先把它调入内存，并且会为这个作业建立与它相对应的进程，也就是建立一个PCB，

* 所以这就是高级调度或者说作业调度要做的事情。如果说当前用户提交了很多作业。 这个时候需要由操作系统来决定，到底要先调入哪个作业，每个作业在整个生命周期内只会调入一次。 调入的时候会建立PCB，当作
  业完成或者说任务完成之后作业会被调出，这个时候才会撤销与之对应的PCB。这是高
  级调度的概念

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160931018.png" alt="image-20230516093120941" style="zoom: 67%;" />

* 接下来看低级调度又可以叫进程调度或者叫处理机调度，因为内存里面其实同时会存在很多很多个进程。 但是系统当中的CPU资源又是有限的，所以操作系统也需要制定某一种策略，从进程就绪队列当中挑选出一个进程。把处理机资源分配给他，多道程序并发执行这件事肯定需要用到进程调度，所以进程调度是操作系统当中最基本的一种调度。 

* 并且进程调度的频率是很高的，因为只有高频率的进程调度才可以让各个进程很快速的轮流的上CPU执行，这样才可以让用户在宏观上看 好像各个进程是同时执行那样。这是低级调度

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160934936.png" alt="image-20230516093407847" style="zoom: 67%;" />

* 最后再来看中级调度，刚才说过，计算机当中有可能会出现内存资源不足的情况，内存里边同时会存在多个进程的数据。如果说内存不足的话其实可以让某一些不太紧急，不太重要的进程，先把这些进程的数据把它从内存调出外存。如果说一个进程的数据从内存放到了外存里边，那这个进程此时就处于挂起状态。操作系统会把这些处于挂起状态的进程，它们的
  PCB组织成一个队列，叫做挂起队列，其实就类似于之前学习过的就绪队列，阻塞队列。 此时如果说已经有空闲的内存资源了，操作系统又需要通过某一种调度策略来决定到底要先把哪个进程的数据先把它调回内存，这个就是终极调度管的事情，又叫做内存调度

* 大家在平时用手机的时候，有时候切换程序或者说切换进程的时候，有的时候切换会发现进程切换的很快，而有的时候进程切换的又很慢，有一种可能的原因就是当进程切换的很快的时候，这个进程的数据有可能是放在内存里边的，而你发现切换进程很卡很慢的时候，有可能是因为你那个进程的数据，它之前已经不在你的手机内存里了，而是被系统调到外存当中。 所以当你切换这个进程的时候，系统发现这个进程现在非运行不可了，它会临时的把
  进程相关的数据从外存再读回内存。 然后只有它读回内存之后，这个进程才可以顺利的运行，因此你会感受到有那么一丝丝的卡顿，其实卡顿的过程就是系统在进行中级调度，选中了你的那个进程，让他回内存运行，显然，在进程运行的生命周期内，有可能会多次调出，多次调入。 所以，中级调度发生的频率肯定要比高级调度要更高。这就是调度的三个层次。高级调度，中级调度和低级调度。

* 既然提到了挂起状态，再来补充一个和挂起状态相关的七状态模型

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160940466.png" alt="image-20230516094055342" style="zoom: 67%;" />

* 其实挂起状态又可以进一步的细分为就绪挂起和阻塞挂起两种状态。之前已经学了进程的五状态模型，也是408里要求掌握的一个进程的状态模型，但是对于一些自主命题的学校来说，也有可能会考察七状态模型，所以大家也不要掉以轻心。

* 在引入了就绪挂起和阻塞挂起两种状态之后。 一个处于就绪态的进程，如果说此时这个系统的负载比较高，内存空间已经不够用了，那么有可能会把一个处于就绪态的进程把它暂时调
  到外存当中，然后这个进程就进入了就绪挂起状态，一直到内存空间空闲，或者说这个进程又需要继续执行，那么这个进程又会被激活。 把它相应的数据又挪回内存当中，这样的话一个就绪挂起的进程又回到了就绪态。 

* 除此之外，一个处于阻塞态的进程也可以被挂起，相应的也可以再重新的被调入内存，然后进行激活，重新回到阻塞态。 而有的操作系统有可能会使一个处于阻塞挂起的进程，当它等待的阻塞事件发生的时候，这个进程就会直
  接进入到就绪挂起的状态，然后之后当它再重新被调回内存的时候，是直接回到就绪态，而不是回到阻塞态。 而有的时候，一个进程当它处于运行态，运行结束之后，可能这个进程下处理机的时候，就会被直接放到外存当中，让它进入就绪挂起的状态。 而有的时候一个处于创建态的进程，当它创建结束之后，创建完PCB之后，有可能出现内存空间不够的情况，那这种情况下也有可能处于创建态的进程之后，会先进入到就绪挂起的状态，这就是所谓的七状态模型，

* 大家需要注意的是挂起和阻塞的区别。 这两种状态都是暂时不能获得CPU服务的两种状态，但是区别在于处于挂起态的进程，进程映像是放在外存里的。 而处于阻塞态的进程，它的进程映像其实还在内存当中。 而有的操作系统也有可能会把这些处于就绪态挂起和阻塞挂起的这些进程分为两个不同的挂起队
  列。当然也有的操作系统还会根据阻塞的原因
  不同，再把阻塞挂起的这些进程再细分为多个队列。这就是七状态模型，大家也需要注意一下

* <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160950116.png" alt="image-20230516095025037" style="zoom:67%;" />

* 再来整理一下三层调度的联系和对比，这三层调度分别要做什么，相信刚才的讲解应该已经比较细了。这儿就不再展开，那么高级调度和中级调度，这两层调度是发生在外存和内存之间的调度。 区别在于高级调度，它是面向作业的调度，一个作业在刚开始会
  被调入一次，被调出一次，并且作业调入的时候会为这个作业建立相应的PCB，也就是建立它相应的进程。而中级调度内存调度，它是面向进程的一种调度，它是把暂时不会运行的进程相关的进程映像相关的一些数据把它调到外存里。 然后之后通过中级调度，再把这些进程的数据从外存调回内存，而低级调度，它是内存和CPU之间的一个调度。 对于这三层调度的发生频率来说，它们的发生频率依次是从低到高的，而这三种调度对进程状态的影响是高级调度有可能会使一个进程从无到创建态,最后当它创建完了PCB，创建完毕之后，还会把这个进程放入到就绪队列里，让它进入就绪态。 所以它对进程
  状态的影响是这个样子，而内存调度它会使一个处于挂起态的进程重新回到就绪态，而如果说挂起态又细分为阻塞挂起和就绪挂起的话。 那么也可以说，它可以使一个处于阻塞挂起的进程，重新回到阻塞态。而低级调度也就是进程调度，它是选择一个处于就
  绪态的进程，让它进入运行态投入处理机开始运行，所以这是这三种调度对进程状态的影响。 

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305160955218.png" alt="image-20230516095504064" style="zoom: 67%;" />

* 再来简单回顾一下这个小节，介绍了处理机调度的基本概念和三个调度的层次，需要注意的是这三种调度的后面一种名称，这三个名称才是在考题当中最高频，最容易出现的一种名称，所以大家需要注意。

* 另外需要理解三层调度的联系和对比，大家在脑子里再回忆一下，对比一下，通过中级调度引出了一个书里没有具体介绍的一个知识点，就是挂起态，并且介绍了和挂起态相关的七状态模型这两个知识点其实在考试当中也是有可能被考到的，特别是自主命题的一些学校。 

* 最后需要注意的是在介绍这几种三层调度的时候都是说他们都是按照某种规则那么这个课当中主要学习的是作业调度和进程调度相关的规则，而这个就是之后要研究的调度算法的问题。