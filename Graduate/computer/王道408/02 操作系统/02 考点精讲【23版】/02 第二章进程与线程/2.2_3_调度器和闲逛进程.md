# 调度器、闲逛进程



## 调度器/调度程序（scheduler）

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305161702928.png" alt="image-20230516170207841" style="zoom:50%;" />

* 调度器或者叫调度程序，很简单的一个概念，调度程序是操作系统内核的一个非常非常重要的程序模块。 

* 一个进程会在就绪，运行， 阻塞之间来回横跳， 2和3这两个状态的转换就是由调度程序来负责完成的。 操作系统的调度程序要决定两个事，首先让谁去运行，这就涉及到调度程序采用的调度算法是什么？ 先来先服务，
  短作业优先还是时间片轮转等等。

* 除了让谁运行之外，还需要决定运行多长时间，不同的进程可以给它分配不同的时间片大小。 所以这就是操作系统的调度程序，反正就是用来管调度的，当前运行的进程要不要让他下处理机，如果他下了处理机那么接下来就绪队列里的这些进程要让谁上处理机
  运行，这就调度程序要管的一个事情，之前
  讲过进程的调度时机

* 现在换一种说法， 就是什么样的事件会触
  发调度程序开始工作，首先，创建一个新进程的时候， 就绪队列会发生改变，就绪队列一变就有可能让新进程抢占当前正在运行的进程的CPU，所以创建新进程的时候， 调度程序会出来工作一下，检查一下要不要让这家伙上处理机

* 除此之外，进程退出也会触发调度程序的工作。 一个正在运行的进程，他此时决定自己
  终结自己，他终结了自己，处理器就空闲了， 因此调度程序就得出来看一下，接下来让谁上处理机工作

* 除此之外，一个正在运行的进程阻塞， 显然也需要调度程序出来看一下，接下来让谁上处理机，再者，发生IO中断的时候， 有可能使得某些阻塞进程回到就绪态，同样的原理， 只要就绪队列一改变，那么调度程序就需要出来检查一下新就绪的进程应不应该让它上处理机运行，应不应该让它抢占等等。 另一点。 值得注意的是， 如果采用的是非抢占式的调度策略，那么只有运行的进程阻塞或者退出的时候才会触发这个调度程序的工作，而如果采用的是抢占式的策略，那么每个时钟中断或者每k个时钟中断，都会触发调度程序出来检查工作，这个很好理解，如果是抢占式的调度策略， 那就意味着只要就
  绪队列一改变。 那就必须检查一下新就绪的进程有没有可能抢占当前正在运行的这些进程，这个检查的动作就是由时钟中断来触发的。每过一个时钟周期，或者每过k个时钟周期，都例行的唤醒一下这个调度程序，让他来检查，此时就绪队列有没有新进程到达， 如果有那么需不需要让他抢占当前正在运行的进程，而如果是非抢占式的调度策略，只有当前运行的进程主动放弃处理机的时候，才有必要唤醒调度程序，让它检查一下，平时只要这个进程还在运行，就没有必要频繁的唤醒这个调度程序，因此非抢占式的这种调度策略不会由时钟中断来唤醒调度程序。

* 这就是所谓的调度程序，只需要知道它是干嘛的，以及什么时候这家伙会出来工作就
  可以了。 刚才说调度的时候，说的是进程的调度，如果一个系统支持的不只是进程，还
  支持线程。

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305161718035.png" alt="image-20230516171846951" style="zoom: 67%;" />

* 那么调度程序调度的对象就变成了线程，在不支持内核级线程的操作系统当中，调度程序调度的对象依然是进程。 而如果支持内
  核级线程，那么调度的处理对象就是内核级的线程， 内核线程会作为调度的基本单位，而进程会作为资源分配的基本单位。这就是调度程序。 

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305161721937.png" alt="image-20230516172150847" style="zoom: 50%;" />

* 接下来看闲逛进程，这个知识点也很简单，如果就绪队列当中没有其他的就绪进程的时候，调度程序就会选中这个闲逛进程，让它上处理器。 也就是说实际的系统当中CPU永远不可能空闲，即便没有其他的就绪进程，那么至少还有一个闲逛进程，它是可以运行的，就跟你没事干的时候就喜欢抖腿一样，CPU没事干的时候也需要闲逛，闲逛进程有这样的一些特性，首先它的优先级在所有的就绪进程当中是最低的。 但凡有其他的一个就绪进程，肯定不会选择让它上处理就运行。
* 另外，在计组当中学过0地址指令，闲逛进程通常就要反复地执行一些零地址指令。 零地址指令就意味着不需要访存甚至不需要去访问CPU里边的任何一个寄存器，因此这种指令也会使得CPU的能耗比较低。 让CPU在闲逛的时候更省电，更不耗能
* 另一个方面在执行完闲逛进程的每一条指
  令之后。 它的这个指令周期的末尾也会例行的检查中断，这个中断就可以周期性的唤醒调度程序，让调度程序来检查，此时到底有没有其他的就绪进程已经就绪， 如果有的话，那么就让闲逛进程下处理机，让其他进程上处理机。 
* 这就是闲逛进程，它是调度程序永远可以选择的一个备胎，不离不弃。 知道它的作用以及知道它的特性就行，这种考点大概率只会在选择题当中出现。

