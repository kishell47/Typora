# 进程的概念、组成、特征



## 知识总览

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111143249.png" alt="image-20230511114311035" style="zoom:50%;" />

* 第二章处理机管理相关的内容。 首先认识一个很重要的概念叫做进程。在第一章的讲解当中，经常会说系统当中正在运行的程序怎么怎么地，怎么怎么地。 偶尔也会提到进程这个术语，进程和程序这两个概念是比较容易混淆，不易理解的，接下来还会介绍进程有哪些部分组成，有什么重要的特征



## 进程的概念

* <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111313208.png" alt="image-20230511131259992" style="zoom:67%;" />
* 首先在Windows电脑里打开任务管理器，任务管理器当中就可以看到，此时系统当中正在运行的进程有这么多。此时如果想要使用QQ的话，打开QQ程序，于是QQ程序就开始运行，相应的在进程这一栏里会看到一个和QQ相关的条目信息，如果此时想要同时登录两个甚至三个QQ号，可以再打开两次QQ程序。
* <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111316021.png" alt="image-20230511131658803" style="zoom:50%;" />
* 在这个时候会发现进程这一栏里QQ相关的条目出现了三条，也就是说在系统当中此时有三个QQ进程正在运行，虽然说这三次我打开的都是QQ.exe这个程序，但是这个程序的三次执行会对应三个不同的进程。 
* 如果大家的电脑现在就在身边的话， 就可以自己动手看一下是不是这样的情况，所以其实程序是一种静态的存放在磁盘里的可执行文件，在Windows电脑里就是QQ.exe，这个可执行文件其实就是一系列的指令集合，而指令的概念在第一章当中讲解过。
* 进程是动态的，是程序的一次执行过程，也就是说，即使是同一个程序多次执行，每一次的执行都会对应一个不同的进程， 就像在这个地方所看到的这样。 所以用这个界面大家应该能够很直观的体会到进程和程序的区别

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111327231.png" alt="image-20230511132735037" style="zoom: 67%;" />

* 那么接下来问题产生了，既然这三个进程执行的都是同一个程序，那么操作系统在背后要怎么区分这三个进程呢？不能把他们都叫做腾讯QQ进程吧
  
  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111329483.png" alt="image-20230511132902300" style="zoom: 50%;" />
  
* 所以为了解决这个问题，操作系统在创建一个进程的时候会给这个进程分配一个唯一的不重复的ID叫做PID， 也就是进程ID，它就相当于人类世界的身份证号，我们每个人的身份证号都是唯一的，是不重复的，而PID就是进程的身份证号

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111343644.png" alt="image-20230511134318358" style="zoom: 67%;" />

* 还是让大家看一个直观的例子，现在正在录制视频，使用的是苹果的电脑。 苹果的电脑有一个叫做活动监视器的小工具，和Windows的任务管理器其实是一样的，可以用这个小工具 看一下，现在在我的系统上正在运行的进程有哪些？这些就是现在正在运行的进程。 这有一个叫做PID，也就是进程ID的属性，让这些进程根据PID的递减的次序来排列。可以看到各个进程的PID都是不重复的

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111346078.png" alt="image-20230511134627867" style="zoom:50%;" />

* 此时打开一个叫做Typora的应用程序，当打开这个应用程序之后，注意观察这个地方出现了和它相对应的一个进程的信息，它的PID是2641。此时再把这个应用程序给退出，然后再一次打开发现它的PID变成了2642

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111348182.png" alt="image-20230511134815964" style="zoom:50%;" />

* 刚才是2641，现在变成了2642， 所以这就能很好的说明一个问题，我们每一次新建一个进程都会给它分配一个不重复的唯一的ID， 在很多操作系统当中，PID的分配都是每一次加—这样的一个很简单的策略。

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111349078.png" alt="image-20230511134943857" style="zoom:50%;" />

* 可以看到现在系统在背后又自己创建了一个新的进程，虽然不知道这个进程是干嘛的，但是它的PID依然是递增的。 所以其实回到刚才的这个图

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111351510.png" alt="image-20230511135121201" style="zoom:50%;" />

* 虽然说这些进程，它们的进程的名称都叫腾讯QQ（32位）， 但是他们在背后都有各自的PID，他们的PID肯定是不重复的。 

* 除了PID之外，操作系统还会记录各个进程其他的一些信息。 比如说它使用了多久的CPU时间，它是由哪个用户所创建的，还有一些各个进程对内存的使用信息

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111354260.png" alt="image-20230511135440068" style="zoom:50%;" />

* 比如这个进程使用了745.7兆字节的内存

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111358626.png" alt="image-20230511135857399" style="zoom:67%;" />

* 另外，操作系统还会统计各个进程对磁盘的访问情况，比如说这个进程向磁盘写入了3.45GB这么多的数据，而其他的进程对磁盘写入和读取的数据会少很多。这些信息其实在我们的进程管理当中都是很有必要的，像这个进程它经常往磁盘里写数据，所以这个进程肯定是一个需要经常访问磁盘的一个进程，操作系统在对这些进程进行管理的时候，都可以根据这些进程的各自的特性来制定相应的策略。

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111403024.png" alt="image-20230511140317810" style="zoom: 80%;" />

* 还有最后的这一列是列出了各个进程对网络流量的使用情况。 

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111406861.png" alt="image-20230511140615639" style="zoom: 50%;" />

* 所以其实操作系统在背后不只是记录了各个进程的PID，除了PID之外还记录了各个进程的其他的一些信息， 比如说刚才所看到的它所属的用户ID或者简称UID，操作系统可以根据PID、UID这些基本的进程描述信息来区分各个进程。 

* 还有刚才看到的分配了多少内存、正在使用哪些IO设备、正在使用哪些文件、这些信息的记录可以帮助操作系统实现对系统资源的管理工作

* 另外还有刚才我们看到的CPU使用时间，磁盘使用情况，网络流量使用情况等等这些信息可以帮助操作系统实现对进程的控制和调度等等一系列的管理策略。 

* 既然操作系统在背后要记录这么多的信息， 那么这些信息都会被统一的放在一个叫做PCB的一个数据结构当中。它的英文是Process Control Block，就是进程控制块，总之，操作系统需要对各个并发运行的进程进行管理。 而但凡它在管理这些进程的时候， 所需要用到的信息都会放在这个叫做PCB的数据结构当中。 

  ![image-20230511141223139](https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111412329.png)

* 所以PCB是一个很重要的数据结构，它是进程存在的唯一标志，当一个进程被创建的时候，操作系统也会为它创建相应的PCB。 当然，这个PCB当中又包含了进程的PID、UID等等一系列的信息，而当一个进程结束的时候，操作系统就会回收它的PCB。

* 在PCB当中需要保存的信息大致上可以分为这样的四类，进程描述信息，进程控制和管理相关的信息，还有资源分配的情况这三种类型的信息，刚才都已经介绍过，除此之外， 还会在PCB当中保留处理机相关的信息，只有在PCB当中保存了处理机相关的信息才可以实现进程的切换工作。 

* 接下来让大家看一个令人脑壳儿疼的东西，在网上找到了Linux的内核源码，然后再一个叫做sched.h这样的文件当中可以看到在Linux操作系统当中，它定义的PCB长什么样子，在Linux当中，它的PCB的名字叫做task_ struct，有兴趣的同学也可以大家去Linux的官网下载一下它的源码来看一下这个文件，在这个task_ struct里边会记录各种各样的信息

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111421994.png" alt="image-20230511142119839" style="zoom:67%;" />

* 比如说这个字段state这个字段，其实就是记录了进程当前的状态是处于就绪态，运行态，还是阻塞态等等

* 进程的状态是我们下一个小节当中会展开介绍的内容。 

* 再来看这个字段files，这个字段记录的是当前进程打开了哪些文件

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111424646.png" alt="image-20230511142416410" style="zoom:67%;" />

  <img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111425703.png" alt="image-20230511142515517" style="zoom:50%;" />

* 有一个叫做io_context的字段，这个字段记录的是I/O管理需要使用到的信息。当然这个数据结构里面定义了好多好多字段，大家可以看一下光是数据结构的定义就写了1900多行的代码。 这么多代码是让人很抓狂的一个事情，总之想要认识PCB当中的所有字段是不可能的， 只需要知道PCB当中存放的都是操作系统在对进程进行管理的时候所需要的那些信息就可以了 

* 除了PCB之外，进程还有两个很重要的组成部分，一个叫做程序段， 一个叫做数据段，刚才说过PCB是给操作系统用的一个数据结构，而程序段和数据段其实是给进程自己用的。



## 知识滚雪球：程序是如何运行的？

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111431024.png" alt="image-20230511143153901" style="zoom:50%;" />

* 具体来看一个例子，在之前的第一章当中，学到了程序在运行之前需要编译成二进制的机器指令。 而程序执行的过程，其实就是CPU，执行这些一条一条的指令的过程。 
* 接下来把程序运行的过程再进一步的细化一下

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111434482.png" alt="image-20230511143412355" style="zoom: 50%;" />

* 写完一个程序之后， 经过编译、链接等等一系列的步骤最终会形成一个可执行文件，像大家熟悉的Windows电脑里就是.exe的文件，这个可执行文件平时是存放在硬盘当中的，这个可执行文件当中保存的其实就是刚才说的那一系列的指令序列。而当这个程序要运行之前，需要把它从硬盘读入到内存当中，并且操作系统会建立一个与它相对应的进程。 根据刚才的分析知道它会建立相对应的PCB，除了PCB之外，这个程序的一系列指令序列也需要读到内存当中，这一系列的指令序列我们把它称作为程序段，其实这个程序执行的过程，或者说这个进程执行的过程就是CPU从内存当中读入这些一条一条的指令，然后来执行这些指令，除了执行这些指令之外，其实，在执行指令的过程当中，会有一些中间的数据，比如说这儿定义了一个变量， 叫做x。 那么这些变量的内容其实也需要放在内存当中，所以还会有另外一个叫做数据段的区域用来存放这个程序运行过程当中所产生所需要使用的各种数据，就比如说我们定义了哪些变量，这些信息就是放在数据段里的。 所以一个进程的实体由PCB、程序段和数据段这三个部分组成。 之前一直在说进程有哪些部分组成，但其实更严格的来说，应该是说进程实体或者说进程映像有哪些部分组成，进程是动态的，而进程实体、进程印象是静态的，可以把进程实体理解为是这个进程在动态执行过程当中某一时刻的一个快照、 一个照片进程实体能够反映这个进程在某一个时刻的状态，比如说这个进程运行的过程当中x的值,这个变量的值本来是一，但是在进行了++这个操作之后x的值就会变成二。 所以，在进程的运行过程当中，进程实体是在不断变化的

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111502776.png" alt="image-20230511150239660" style="zoom:50%;" />

* 所以准确的说，进程实体由PCB、程序段和数据段这三个部分组成。 除非题目特别考察进程和进程实体、进程映像的区别，不然大家也可以认为所谓的进程就是进程实体没必要去钻这个牛角尖，扣这个字眼。 
* PCB是给管理者也就是给操作系统使用的，而程序段和数据段里面的内容是给进程自己使用的，和进程自己的运行逻辑有关。
* 所以在引入了进程实体的概念之后，可以把进程定义为这样，进程是进程实体的一个运行过程，是系统进行资源分配和调度的独立单位。 进程是资源分配的独立单位这一点很好理解。 

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111505794.png" alt="image-20230511150529585" style="zoom:50%;" />

* 从刚才活动监视器也可以看到操作系统是以进程为单位，给各个进程来分配这些资源的，比如说内存。 所以进程是资源分配的独立单位，这个地方还涉及到另一个概念叫做进程的调度，调度就是指操作系统决定让哪个进程上CPU运行。 进程的调度相关的内容会在之后的小节当中有更进一步的学习，总之，一个程序运行多次会对应多个进程，如果说同时挂三个QQ号的话，那么，这三个QQ进程的PCB和数据段都是各不相同的，它们的PCB不相同，这个很好理解，刚才我们也已经解释过了。而数据段不相同是因为登录的三个QQ号的信息数据这些都是存放在数据段当中的，所以三个不同的QQ号的数据段肯定是不同的。 但是这三个QQ进程背后运行的其实是相同的QQ程序，也就是它们的程序段内容其实是相同的。 



## 进程的特征

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111510366.png" alt="image-20230511151054227" style="zoom: 50%;" />

* 之前介绍了进程的定义和进程的组成，接下来看一下进程有哪些特征，相比于程序，进程拥有以下的一些特征
* 第一叫做动态性，因为进程是程序的一次执行过程，或者说进程是进程实体的一次执行过程。 它是动态的产生变化和消亡的，所以动态性很好理解，它也是进程的一个最基本的特性。
* 第二个特性叫并发性， 是指内存当中同时会有多个进程实体，然后各个进程可以并发的执行，这一点在经过第一章的学习相信也很好理解。 
* 独立性是指进程能够独立运行，独立获得资源，独立接受调度。
* 各个并发运行的进程还会有异步性， 就是指它们以各自独立的，不可预知的速度向前推进。 进程的并发带来的异步性可能会让进程的执行结果不确定，但是有的时候我们又必须让并发执行的进程来相互配合协调着工作。具体怎么实现呢？这个我们会在进程同步的小节当中进行学习，这儿先不展开。 
* 最后进程还拥有结构性，就是指每个进程都会有一个PCB，一个程序段， 数据段。 所有的这些特性，大家都只需要理解， 不需要死记硬背。



## 知识回顾与重要考点

<img src="https://cvp.oss-cn-shanghai.aliyuncs.com/picgo/202305111515888.png" alt="image-20230511151520744" style="zoom: 80%;" />

* 这个小节介绍了进程这个很重要的概念，进程或者说进程实体由PCB、程序段和数据段这三个部分组成。
* PCB是一个很重要的数据结构，它是进程存在的唯一标志，操作系统就是通过PCB里边记录的这些各种各样的信息来对各个进程进行管理的。 
* 所以但凡是操作系统管理进程所需要的数据， 肯定都是放在PCB当中，而进程自己所需要的数据是放在程序段和数据段当中的。 
* 另外需要注意的是进程的动态性是它最基本的特性。 并且还需要注意进程是独立获得资源、 独立接受调度的一个基本单位。 让大家注意这一点的原因是在引入了线程之后，进程就不再是接受调度的基本单位了，但是进程依然是获得资源的基本单位，这点还会经过后续的小节进行进一步的讲解，这儿暂时先不展开。 